<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Ping Tester</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 2em; background-color: #f4f4f9; color: #333; }
        #container { max-width: 600px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h1 { color: #007AFF; }
        input, button { font-size: 1em; padding: 0.5em 1em; margin-top: 0.5em; border-radius: 5px; border: 1px solid #ddd; }
        button { background-color: #007AFF; color: white; cursor: pointer; border-color: #007AFF; }
        button:disabled { background-color: #ccc; cursor: not-allowed; border-color: #ccc; }
        #log { margin-top: 1em; background-color: #eee; padding: 1em; border-radius: 5px; height: 200px; overflow-y: auto; white-space: pre-wrap; font-family: monospace; }
    </style>
</head>
<body>
    <div id="container">
        <h1>WebSocket Ping Tester</h1>
        <div>
            <label for="url">WebSocket URL:</label>
            <input type="text" id="url" value="ws://localhost:8001/ws/ping" style="width: 100%; box-sizing: border-box;">
        </div>
        <div>
            <button id="connectBtn">Connect</button>
            <button id="disconnectBtn" disabled>Disconnect</button>
        </div>
        <div style="margin-top: 1em;">
            <label for="message">Message to send:</label>
            <input type="text" id="message" value="ping" style="width: 60%; box-sizing: border-box;">
            <button id="sendBtn" disabled>Send Ping</button>
        </div>
        <h3>Log:</h3>
        <div id="log"></div>
    </div>

    <script>
        const urlInput = document.getElementById('url');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const sendBtn = document.getElementById('sendBtn');
        const messageInput = document.getElementById('message');
        const logDiv = document.getElementById('log');

        let ws = null;

        function log(message) {
            const line = document.createElement('div');
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        connectBtn.onclick = () => {
            const url = urlInput.value;
            if (!url) {
                log('ERROR: URL cannot be empty.');
                return;
            }

            log(`Attempting to connect to ${url}...`);
            ws = new WebSocket(url);

            ws.onopen = () => {
                log('✅ CONNECTION OPENED');
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                sendBtn.disabled = false;
            };

            ws.onmessage = (event) => {
                log(`⬅️ RECEIVED: ${event.data}`);
            };

            ws.onerror = (event) => {
                log('❌ ERROR: An error occurred. Check the console for details.');
                console.error('WebSocket Error:', event);
            };

            ws.onclose = (event) => {
                log(`🔌 CONNECTION CLOSED: Code=${event.code}, Reason=${event.reason || 'No reason given'}`);
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                sendBtn.disabled = true;
                ws = null;
            };
        };

        sendBtn.onclick = () => {
            if (!ws) {
                log('ERROR: Not connected.');
                return;
            }
            const message = messageInput.value || 'ping';
            log(`➡️ SENDING: ${message}`);
            ws.send(message);
        };

        disconnectBtn.onclick = () => {
            if (ws) {
                ws.close();
            }
        };
    </script>
</body>
</html>
